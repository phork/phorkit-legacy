$(function(){var b=PHORK.registry;PHORK.registry.overlay=null;PHORK.overlay={};var a=function(){};PHORK.overlay.core=a;a.prototype.init=function(d,f){var e=this;
this.$element=d;this.$overlay=null;this.$content=null;this.$toolbar=null;this.$buttons=null;this.config=f||{};return this};a.prototype.bind=function(e){var d=this;
this.$element.bind(e,function(f){f.preventDefault();return d.toggle()});return this};a.prototype.load=function(){var d=this;this.$overlay?this.$overlay.empty():$("body").append(this.$overlay=$("<div></div>").hide());
if(this.config.toolbar){this.$overlay.append(this.$toolbar=$("<div></div>").addClass("overlay-toolbar").append($("<div></div>").addClass("overlay-close").bind("click",function(){d.hide()
})))}this.$overlay.addClass("overlay"+(this.config.type?" "+this.config.type:"")).append(this.$content=$("<div></div>").addClass("overlay-content").append(function(h,i){if(d.config.source=="element"){if(!d.config.width){d.config.width=d.$element.width()
}if(!d.config.height){d.config.height=d.$element.height()}return d.$element.detach()}else{if(d.config.source=="message"){if(d.config.message){return d.config.message
}else{if(this.$element){return this.$element.data("message")}}}else{return $("<div></div>").addClass("loading")}}}));if(this.config.width){this.$content.width(this.config.width)
}if(this.config.height){this.$content.height(this.config.height)}switch(this.config.source){case"element":this.resize().$content.show();break;case"template":var g=this.$element&&this.$element.data("template")?this.$element.data("template"):this.config.template;
this.$overlay.html($("#"+g+"-tmpl").html().replace(/\[{2}([A-Z-]+)\]{2}/g,function(i,h){return d.$element.data(h.toLowerCase())}));if(typeof this.config.initialized=="function"){this.config.initialized(this,[true])
}break;case"url":var e=this.$element&&this.$element.attr("href")?this.$element.attr("href")+"?overlay=1":this.config.href;this.$content.load(e,function(i,h,j){if(h=="success"){d.$overlay.addClass("initialized")
}else{$(this).html("Uh oh. Something went wrong.");d.$overlay.addClass("error")}if(typeof d.config.initialized=="function"){d.config.initialized(d,h=="success",j)
}d.resize()});break;case"iframe":var e=this.$element&&this.$element.attr("href")?this.$element.attr("href"):this.config.href;this.$content.empty().append($("<iframe></iframe>").attr("src",e).width("100%").height("100%"));
break;default:if(typeof this.config.initialized=="function"){this.config.initialized(this,true)}this.$overlay.addClass("initialized");break}if(this.config.buttons){this.$overlay.append(this.$buttons=$("<div></div>").addClass("overlay-buttons"));
for(var f in this.config.buttons){(function(){var h=d.config.buttons[f];d.$buttons.append($("<button></button>").html(h.value).bind("click",function(){if(typeof h.action=="function"){h.action(d)
}if(h.close){setTimeout(function(){d.hide()},100)}}).addClass(h.type).data(h.data?h.data:{}))})()}}return this};a.prototype.resize=function(f){var d=this.$content.width(),h=this.$content.height(),e=this.$content.attr("scrollWidth"),g=this.$content.attr("scrollHeight"),j=e-d,i=g-h;
if((!f||f.width)&&j>0){this.$overlay.width(this.$overlay.width()+j);this.$content.width(d+j)}if((!f||f.height)&&i>0){this.$overlay.height(this.$overlay.height()+i);
this.$content.height(h+i)}if(this.$toolbar){this.$toolbar.width(this.$content.width())}return this.position()};a.prototype.position=function(){var e=$(window).width(),i=$(window).height(),d=this.$overlay.width(),h=this.$overlay.height(),g=Math.round(e*0.8),f=Math.round(i*0.8);
if(d==(d=Math.min(d,g))&&h==(h=Math.min(h,f))){this.$content.addClass("noscroll")}switch(this.config.position){case"attached":this.$overlay.css({position:"absolute",top:this.$element.offset().top,left:this.$element.offset().left,width:d+"px",height:h+"px"});
break;case"cursor":this.$overlay.css({position:"absolute",top:b.mouse?b.mouse.y:this.$element.offset().top,left:b.mouse?b.mouse.x:this.$element.offset().left,width:d+"px",height:h+"px"});
break;default:this.$overlay.css({top:Math.round((i-h)/2)+"px",left:Math.round((e-d)/2)+"px"});break}return this};a.prototype.toggle=function(){if(this.config.toggleable&&this.$overlay&&this.$overlay.is(":visible")){return this.hide()
}else{return this.show()}return this};a.prototype.show=function(){var d=this;b.overlay&&(b.overlay.modal||b.overlay.config.solo)&&b.overlay.hide();if(this.$overlay||this.load()){if(this.config.modal){$("body").trigger("disable")
}if(this.config.transition&&this.config.transition.show){this.$overlay[this.config.transition.show](400)}else{this.$overlay.show()}this.position();if(this.config.duration){setTimeout(function(){d.hide()
},this.config.duration)}b.overlay=this}return this};a.prototype.hide=function(){if(this.$overlay){if(this.config.transition&&this.config.transition.hide){this.$overlay[this.config.transition.hide](400)
}else{this.$overlay.hide()}if(this.config.modal){$("body").trigger("enable")}if(this.config.disposable){this.destroy()}b.overlay=null}return this};a.prototype.destroy=function(){if(this.$overlay){this.$overlay.remove();
this.$overlay=null}return this};var c=function(){};c.inheritsFrom(a);PHORK.overlay.tooltip=c;c.prototype.init=function(d,e){this.delayed={show:null,hide:null};
e=e||{};e.disposable=false;e.toolbar=false;if(!e.type){e.type="tooltip"}if(!e.position){e.position="cursor"}this.parent.init.call(this,d,e);this.load().bind(null)
};c.prototype.bind=function(e){var d=this;this.$element.bind("mouseover",function(f){clearTimeout(d.delayed.hide);if(!d.$overlay.is(":visible")){d.delayed.show=setTimeout(function(){d.show().resize()
},400)}}).bind("mouseout",function(f){clearTimeout(d.delayed.show);if(d.$overlay.is(":visible")){d.delayed.hide=setTimeout(function(){d.hide()},400)}});
this.$overlay.bind("mouseover",function(f){d.$element.trigger("mouseover")}).bind("mouseout",function(f){d.$element.trigger("mouseout")});$(window).bind("scroll",function(){d.$overlay.trigger("mouseleave")
});return this};$("body").bind("disable",function(){var e=$(this),d=e.data("modal");if(!d){e.data("modal",d={counter:0,$element:$("<div></div>").addClass("disabled").height($(document).height())});
e.append(d.$element)}d.counter++;d.$element.show()}).bind("enable",function(){var e=$(this),d=e.data("modal");if(d&&--d.counter==0){d.$element.hide()}});
$(window).bind("keydown",function(d){if(d.keyCode==27){if(b.overlay){b.overlay.hide()}}})});